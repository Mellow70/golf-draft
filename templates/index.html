<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Fantasy Golf Draft - PGA Championship</title>    <script src="https://cdn.tailwindcss.com"></script></head><body class="bg-gray-100">    <div class="container mx-auto p-4">        <h1 class="text-3xl font-bold mb-4">Fantasy Golf Draft - PGA Championship</h1>        <div class="mb-4">            {% if session.username %}                <span class="font-semibold">Logged in as: {{ session.username }}</span>                <a href="{{ url_for('logout') }}" class="ml-4 text-blue-500 hover:underline">Logout</a>            {% else %}                <span class="font-semibold">Not logged in</span>                <a href="{{ url_for('login') }}" class="ml-4 text-blue-500 hover:underline">Login</a>            {% endif %}        </div>        {% if draft_complete %}            <div class="bg-green-100 p-4 rounded">                <h2 class="text-xl font-semibold">Draft Complete!</h2>                <p>All players have made their picks.</p>            </div>        {% else %}            <div class="bg-blue-100 p-4 rounded mb-4">                <h2 class="text-xl font-semibold">Current Turn</h2>                <p>Pick <span id="current-pick-number">{{ current_pick_number }}</span>: <span id="current-player">{{ current_player }}</span></p>                <p>Time remaining: <span id="timer">{{ timer_seconds }}</span> seconds</p>            </div>            {% if session.username %}                <div class="mb-4">                    <h2 class="text-xl font-semibold">Make a Pick</h2>                    <select id="golfer-select" class="border p-2 rounded">                        <option value="">Select a golfer</option>                        {% for golfer in golfers %}                            <option value="{{ golfer }}">{{ golfer }}</option>                        {% endfor %}                    </select>                    <button id="pick-button" class="bg-blue-500 text-white px-4 py-2 rounded ml-2">Pick Golfer</button>                </div>            {% endif %}        {% endif %}        <div class="mb-4">            <h2 class="text-xl font-semibold mb-2">Players and Picks</h2>            <table class="w-full border-collapse border">                <thead>                    <tr class="bg-gray-200">                        <th class="border p-2">Player</th>                        <th class="border p-2">Picks</th>                    </tr>                </thead>                <tbody id="players-picks">                    {% for player in players %}                        <tr>                            <td class="border p-2">{{ player }}</td>                            <td class="border p-2">                                {% if player_picks[player] %}                                    {{ player_picks[player] | map(attribute='Golfer') | join(', ') }}                                {% else %}                                    No picks yet                                {% endif %}                            </td>                        </tr>                    {% endfor %}                </tbody>            </table>        </div>        <div>            <h2 class="text-xl font-semibold mb-2">Draft Board</h2>            <table class="w-full border-collapse border">                <thead>                    <tr class="bg-gray-200">                        <th class="border p-2">Player</th>                        <th class="border p-2">Golfer</th>                        <th class="border p-2">Pick Time</th>                    </tr>                </thead>                <tbody id="draft-board">                    {% for pick in picks %}                        <tr>                            <td class="border p-2">{{ pick.Player }}</td>                            <td class="border p-2">{{ pick.Golfer }}</td>                            <td class="border p-2">{{ pick['Pick Time'] }}</td>                        </tr>                    {% endfor %}                </tbody>            </table>        </div>    </div>    <script>        const timerSeconds = {{ timer_seconds }};        let timeLeft = timerSeconds;        let timerInterval = null;        const draftComplete = {{ draft_complete | tojson }};        function startTimer() {            if (draftComplete) return;            timerInterval = setInterval(() => {                timeLeft--;                document.getElementById('timer').textContent = timeLeft;                if (timeLeft <= 0) {                    clearInterval(timerInterval);                    triggerAutopick();                }            }, 1000);        }        function resetTimer() {            clearInterval(timerInterval);            timeLeft = timerSeconds;            document.getElementById('timer').textContent = timeLeft;            startTimer();        }        function triggerAutopick() {            fetch('/autopick', {                method: 'POST',                headers: { 'Content-Type': 'application/x-www-form-urlencoded' }            })            .then(response => response.json())            .then(data => {                if (data.success) {                    updateDraftBoard(data.player, data.golfer, data.pick_time);                    updateCurrentTurn(data.player, data.golfer);                } else {                    console.error('Autopick failed: ' + (data.error || 'Unknown error'));                    updateCurrentTurn();                }            })            .catch(error => {                console.error('Autopick error:', error);                updateCurrentTurn();            });        }        function updateDraftBoard(player, golfer, pickTime) {            const tbody = document.getElementById('draft-board');            const row = document.createElement('tr');            row.innerHTML = `                <td class="border p-2">${player}</td>                <td class="border p-2">${golfer}</td>                <td class="border p-2">${pickTime}</td>            `;            tbody.appendChild(row);            const playerRow = Array.from(document.querySelectorAll('#players-picks tr')).find(row =>                 row.cells[0].textContent === player            );            if (playerRow) {                const picksCell = playerRow.cells[1];                const currentPicks = picksCell.textContent === 'No picks yet' ? [] : picksCell.textContent.split(', ');                currentPicks.push(golfer);                picksCell.textContent = currentPicks.join(', ');            }        }        function updateCurrentTurn(lastPlayer = null, lastGolfer = null) {            let attempts = 0;            const maxAttempts = 5;            const checkState = () => {                fetch('/draft_state')                    .then(response => response.json())                    .then(data => {                        if (data.error) {                            console.error('Error fetching draft state: ' + data.error);                            if (attempts < maxAttempts) {                                attempts++;                                setTimeout(checkState, 1000);                            }                            return;                        }                        const lastPickFound = lastPlayer && lastGolfer && data.picks.some(p =>                             p.Player === lastPlayer && p.Golfer === lastGolfer                        );                        if (!lastPickFound && attempts < maxAttempts) {                            attempts++;                            setTimeout(checkState, 1000);                            return;                        }                        const currentPlayerElement = document.getElementById('current-player');                        const currentPickNumberElement = document.getElementById('current-pick-number');                        currentPlayerElement.textContent = data.current_player || '';                        currentPickNumberElement.textContent = data.current_pick_number || '';                        const golferSelect = document.getElementById('golfer-select');                        if (golferSelect) {                            golferSelect.innerHTML = '<option value="">Select a golfer</option>';                            data.available_golfers.forEach(golfer => {                                const option = document.createElement('option');                                option.value = golfer;                                option.textContent = golfer;                                golferSelect.appendChild(option);                            });                        }                        const draftBoard = document.getElementById('draft-board');                        draftBoard.innerHTML = '';                        data.picks.forEach(pick => {                            const row = document.createElement('tr');                            row.innerHTML = `                                <td class="border p-2">${pick.Player}</td>                                <td class="border p-2">${pick.Golfer}</td>                                <td class="border p-2">${pick['Pick Time']}</td>                            `;                            draftBoard.appendChild(row);                        });                        const playersPicks = document.getElementById('players-picks');                        playersPicks.innerHTML = '';                        Object.keys(data.player_picks).forEach(player => {                            const row = document.createElement('tr');                            const picks = data.player_picks[player].map(p => p.Golfer).join(', ') || 'No picks yet';                            row.innerHTML = `                                <td class="border p-2">${player}</td>                                <td class="border p-2">${picks}</td>                            `;                            playersPicks.appendChild(row);                        });                        if (data.draft_complete) {                            location.reload();                        } else {                            resetTimer();                        }                    })                    .catch(error => {                        console.error('Error fetching draft state:', error);                        if (attempts < maxAttempts) {                            attempts++;                            setTimeout(checkState, 1000);                        } else {                            resetTimer();                        }                    });            };            checkState();        }        document.getElementById('pick-button')?.addEventListener('click', () => {            const golfer = document.getElementById('golfer-select').value;            if (!golfer) {                alert('Please select a golfer');                return;            }            fetch('/pick', {                method: 'POST',                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },                body: `golfer=${encodeURIComponent(golfer)}`            })            .then(response => response.json())            .then(data => {                if (data.success) {                    updateDraftBoard(data.player, data.golfer, data.pick_time);                    updateCurrentTurn(data.player, data.golfer);                } else {                    alert('Pick failed: ' + (data.error || 'Unknown error'));                    updateCurrentTurn();                }            })            .catch(error => {                console.error('Pick error:', error);                updateCurrentTurn();            });        });        if (!draftComplete) {            startTimer();        }    </script></body></html>